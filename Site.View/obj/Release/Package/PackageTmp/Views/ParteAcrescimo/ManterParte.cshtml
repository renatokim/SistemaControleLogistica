@using Site.Entidade.Pedidos
@using Site.Enums
@using Site.IServico.Pedidos
@using Site.Servico.Pedidos
@model Site.Entidade.Pedidos.ParteAcrescimo

@{
    ICategoriaServico categoriaServico = new CategoriaServico();

    List<Categoria> partesAcrescimos = Model.ParteOuAcrescimo == ParteOuAcrescimo.Parte 
        ? categoriaServico.GetAll().Where(t => t.Tipo == 1).Where(s => s.Ativo == Status.Ativo).OrderBy(d => d.Descricao).ToList() 
        : categoriaServico.GetAll().Where(t => t.Tipo == 2).Where(s => s.Ativo == Status.Ativo).OrderBy(d => d.Descricao).ToList();
}

<script src="~/Scripts/bootstrap/js/bootstrap.min.js"></script>
<script src="~/Scripts/libraries/jquery.maskedinput.min.js"></script>
<script type="text/javascript">
    $(function () {
        $(".Consumo").mask("9,99");
        $(".ConsumoPonto").mask("9.99");
        //$.mask.definitions['~'] = "[+-]";
        //$("#date").mask("99/99/9999", { completed: function () { alert("completed!"); } });
        //$("#phone").mask("(999) 999-9999");
        //$("#phoneExt").mask("(999) 999-9999? x99999");
        //$("#iphone").mask("+33 999 999 999");
        //$("#tin").mask("99-9999999");
        //$("#ssn").mask("999-99-9999");
        //$("#product").mask("a*-999-a999", { placeholder: " " });
        //$("#eyescript").mask("~9.99 ~9.99 999");
        //$("#po").mask("PO: aaa-999-***");
        //$("#pct").mask("99%");

        //$("input").blur(function () {
        //    $("#info").html("Unmasked value: " + $(this).mask());
        //}).dblclick(function () {
        //    $(this).unmask();
        //});
    });

</script>

@using (Html.BeginForm("ManterParte", "ParteAcrescimo"))
{
    string label = "label-info";
    string botaoCor = "btn-primary";
    string botaoLabel = "Cadastrar";
    
    if (Model.Id > 0)
    {
        label = "label-warning";
        botaoCor = "btn-warning";
        botaoLabel = "Editar";
    }

    <fieldset>
        
        @Html.HiddenFor(m => m.Id)
        @Html.HiddenFor(m => m.ParteOuAcrescimo)

        <div class="span12">
            
            @Html.Partial("../Shared/_Mensagem")

            <div class="alert alert-info">
                <div style="text-align: center;">
                    <h4>
                        @(Model.ParteOuAcrescimo == ParteOuAcrescimo.Parte ? "PARTES" : "ACRÉSCIMOS")
                    </h4>
                </div>
            </div>
            <table>
                <tbody>
                    <tr>
                        <td>
                            <span class="label @label">Categoria</span>
                        </td>
                        <td>
                            <span class="label @label">Descrição</span>
                        </td>
                        <td>
                            <span class="label @label">Consumo Tecido</span>
                        </td>
                        <td>
                            <span class="label @label">Unidade de Medida</span>
                        </td>
                        <td>
                            <span class="label @label">Status</span>
                        </td>
                        <td>
                            <span class="label @label"></span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <select id="categoriaId" name="Categoria.Id" required="">
                                <option value=""></option>
                                @{
                                    foreach (var item in partesAcrescimos)
                                    {
                                        string select = item.Id == Model.Categoria.Id ? "selected" : string.Empty;
                                        <option value="@item.Id" @select>@item.Descricao</option>
                                    }
                                }
                            </select>
                        </td>
                        <td>
                            <input type="text" id="Descricao" name="Descricao" maxlength="45" required="" value="@Model.Descricao">
                        </td>
                        <td>
                            <input id="ConsumoTecido" class="input-medium Consumo" type="text" name="ConsumoTecido" pattern="[0-9]*[,|.]*[0-9]*" maxlength="45" value="@Model.ConsumoTecido.ToString("0.00")">
                        </td>
                        <td>
                            @{ 
                                var items = new List<SelectListItem> 
                                {
                                    new SelectListItem {Text = "", Value = ""}, 
                                    new SelectListItem {Text = "MT", Value = "MT"}, 
                                    new SelectListItem {Text = "KG", Value = "KG"}, 
                                    new SelectListItem {Text = "UN", Value = "UN"}, 
                                    new SelectListItem {Text = "PC", Value = "PC"}
                                };
                                @Html.DropDownListFor(m => m.UnidadeMedida, items)
                            }
                        </td>
                        <td>
                            @{
                                var status = new List<SelectListItem>
                                {
                                    new SelectListItem {Text = "Ativo", Value = Status.Ativo.ToString()},
                                    new SelectListItem {Text = "Inativo", Value = Status.Inativo.ToString()}
                                };
                                @Html.DropDownListFor(m => m.Status, status)
                            }
                        </td>

                        <td>
                            <a href="#TipoAviamento" role="button" class="btn" data-toggle="modal" style="margin-top: -12px">Tipo Aviamento</a>
                        </td>
                        <td>
                            <button type="submit" class="btn @botaoCor incluirParte" style="margin-top: -10px">
                                @botaoLabel
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        @Html.Partial("../Aviamento/_TipoAviamento", Model.TipoAviamento)
    </fieldset>

    <div style="margin-left: 60px">
        @(Model.ParteOuAcrescimo == ParteOuAcrescimo.Parte ? Html.ActionLink("Inativos", "ManterParte", new { status = "Inativo" }) : Html.ActionLink("Inativos", "ManterAcrescimo", new { status = "Inativo" }))
        <font>|</font>
        @(Model.ParteOuAcrescimo == ParteOuAcrescimo.Parte ? Html.ActionLink("Ativos", "ManterParte", new { status = "Ativo" }) : Html.ActionLink("Ativos", "ManterAcrescimo", new { status = "Ativo" }))
    </div>

    
    @(Model.ParteOuAcrescimo == ParteOuAcrescimo.Parte ? Html.Partial("_listaPartes", Model) : Html.Partial("_listaAcrescimos", Model))
    
    <input type="hidden" id="tipoAviamentoJson" name="tipoAviamentoString" value="" />
}


@using Site.DTO
@using Site.Entidade.Pedidos
@using Site.Servico.Pedidos
@model Site.Entidade.Pedidos.PedidoProduto

@{
    Layout = null;
}

<table class="table">
    <tr>
        <th>
            Quantidade
        </th>
        <th>
            Item
        </th>
        <th>
            Obs
        </th>
        <th>
            Tecido
        </th>
        <th>
            Aviamentos
        </th>
        <th>
            Ação
        </th>
    </tr>
    @{
        if (Model.ProdutoParteAcrescimo != null && Model.ProdutoParteAcrescimo.Count > 0)
        {
            foreach (var item in Model.ProdutoParteAcrescimo)
            {
                if (string.IsNullOrEmpty(item.ParteAcrescimo.Descricao))
                {
                    var parteAcrescimo = new ParteAcrescimoServico().GetParteById(item.ParteAcrescimo.Id);
                    item.ParteAcrescimo = parteAcrescimo ?? new ParteAcrescimoServico().GetAcrescimoById(item.ParteAcrescimo.Id);
                }

                <tr data-categoria="@item.ParteAcrescimo.Categoria.Descricao" >
                    <td>
                        @item.Quantidade
                    </td>
                    <td>
                        @item.ParteAcrescimo.Nome
                    </td>
                    <td class="Obs">
                        @item.Obs
                    </td>
                    <td>
                        @{
                            if (item.Tecido != null)
                            {
                                @item.Tecido.Nome
                            }
                        }
                    </td>
                    <td>
                        @foreach (var partAcreAv in item.ParteAcrescimoAviamento)
                        {
                            if (partAcreAv.Aviamento.TipoAviamento == null)
                            {
                                partAcreAv.Aviamento = new AviamentoServico().GetAviamentoByFilter(new DTOFiltroAviamento {Id = partAcreAv.Aviamento.Id}).FirstOrDefault(); //.GetAll().FirstOrDefault(x => x.Id == partAcreAv.Aviamento.Id);
                            }

                            string format = string.Format("{0} {1} {2} {3}", partAcreAv.Quantidade, partAcreAv.Aviamento.TipoAviamento.Descricao, partAcreAv.Aviamento.Cor.Descricao, partAcreAv.Aviamento.Codigo.Descricao);
                            @format
                            <br/>
                        }
                    </td>
                    <td>
                        <a class="editarParteAcrescimo" data-parte-acrescimo="@item.RowNum">Editar</a>
                        |
                        <a class="removerParteAcrescimo" data-parte-acrescimo="@item.RowNum">Remover</a>
                    </td>
                </tr>
            }
        }
    }
</table>

<div id="ProdutoPedido" style="display: none">@Model.PedidoProdutoJson</div>

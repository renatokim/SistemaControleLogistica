@using Site.DTO
@using Site.Enums
@using Site.IServico
@using Site.IServico.Fluxo
@using Site.IServico.Pedidos
@using Site.Servico
@using Site.Servico.Fluxo
@using Site.Servico.Pedidos
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>
<body>

    @{
        IPedidoServico pedidoServico = new PedidoServico();
        IFluxoServico fluxoServicoServico = new FluxoServico();
        IFaccaoServico faccaoServico = new FaccaoServico();
        var pedidos = pedidoServico.ListarPedidos(new DTOFiltroPedido { StatusPedido = 1 });
        var allfluxos = fluxoServicoServico.GetAll();
        var faccoes = faccaoServico.GetAll().Where(x => x.Status == Status.Ativo).OrderBy(y => y.Descricao).ToList();
    }

    <div>
        <div class="container">@Html.Partial("../Shared/_Mensagem")</div>
    </div>
    @using (Html.BeginForm())
    {
        <div style="margin-left: 50px; margin-right: 50px">
            <h3>Lançar Lote</h3>
            <ul class="nav nav-tabs">
                <li class="active"><a id="link_pedidoEtapaAcao" href="#PedidoEtapaAcao">Pedido / Etapa / Ação</a></li>
                <li><a id="link_produtos" href="#Produtos">Produtos</a></li>
                <li><a id="link_lancamentos" href="#Lancamentos">Lançamentos</a></li>
            </ul>

            <div class="tab-content">
                <div id="PedidoEtapaAcao" class="tab-pane fade in active">
                    <div class="row-fluid">
                        <div class="span4">
                            <h4>
                                Cliente / Pedido
                            </h4>

                            <div class="controls">
                                <table class="table">

                                    @foreach (var pedido in pedidos)
                                    {
                                        var pedidoNumero = @pedido.Cliente.Nome + " - " + @pedido.Numero;
                                        <tr id="@pedido.Numero">
                                            <td>
                                                @if (Model.Pedidos.Contains(pedido.Id))
                                                {
                                                    <input class='pedidos_check' type='checkbox' checked='checked' name='Pedidos' value='@pedido.Id' style="margin-top: 0" />
                                                }
                                                else
                                                {
                                                    <input class='pedidos_check' type='checkbox' name='Pedidos' value='@pedido.Id' style="margin-top: 0" />
                                                }
                                            </td>
                                            <td>
                                                @pedidoNumero
                                            </td>
                                        </tr>
                                    }

                                </table>
                            </div>
                        </div>
                        <div class="span4">
                            <h4>
                                Etapas
                            </h4>
                            <table>
                                <tr>
                                    <td>
                                        <table class="table">
                                            @if (Model.Etapas.Contains(0))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='0' style="margin-top: -2px" /> Arte</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='0' style="margin-top: -2px" /> Arte</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(1))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='1' style="margin-top: -2px" /> Modelagem</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='1' style="margin-top: -2px" /> Modelagem</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(2))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='2' style="margin-top: -2px" /> Matéria Prima</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='2' style="margin-top: -2px" /> Matéria Prima</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(3))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='3' style="margin-top: -2px" /> Corte</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='3' style="margin-top: -2px" /> Corte</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(4))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='4' style="margin-top: -2px" /> Silk Parte</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='4' style="margin-top: -2px" /> Silk Parte</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(5))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='5' style="margin-top: -2px" /> Bordado Parte</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='5' style="margin-top: -2px" /> Bordado Parte</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(6))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='6' style="margin-top: -2px" /> Costura</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='6' style="margin-top: -2px" /> Costura</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(7))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='7' style="margin-top: -2px" /> Botões</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='7' style="margin-top: -2px" /> Botões</td></tr>
                                            }
                                        </table>
                                    </td>
                                    <td>
                                        <table class="table">
                                            @if (Model.Etapas.Contains(8))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='8' style="margin-top: -2px" /> Conferência</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='8' style="margin-top: -2px" /> Conferência</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(9))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='9' style="margin-top: -2px" /> Etapa Extra 1</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='9' style="margin-top: -2px" /> Etapa Extra 1</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(10))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='10' style="margin-top: -2px" /> Silk Peça</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='10' style="margin-top: -2px" /> Silk Peça</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(11))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='11' style="margin-top: -2px" /> Bordado Peça</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='11' style="margin-top: -2px" /> Bordado Peça</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(12))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='12' style="margin-top: -2px" /> Botão Posterior</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='12' style="margin-top: -2px" /> Botão Posterior</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(13))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='13' style="margin-top: -2px" /> Etapa Extra 2</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='13' style="margin-top: -2px" /> Etapa Extra 2</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(14))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='14' style="margin-top: -2px" /> Embalagem</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='14' style="margin-top: -2px" /> Embalagem</td></tr>
                                            }
                                            @if (Model.Etapas.Contains(15))
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' checked="checked" name='Etapas' value='15' style="margin-top: -2px" /> Entrega</td></tr>
                                            }
                                            else
                                            {
                                                <tr><td><input class='etapas_check' type='checkbox' name='Etapas' value='15' style="margin-top: -2px" /> Entrega</td></tr>
                                            }
                                        </table>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="span4">
                            <h4>
                                Ação
                            </h4>
                            <table class="table">
                                <tr><td><input class='acao_check' id="check_enviar" type='checkbox' name='Acoes' value='0' style="margin-top: -2px" /> Enviar</td></tr>
                                <tr><td><input class='acao_check' id="check_retornar" type='checkbox' name='Acoes' value='1' style="margin-top: -2px" /> Retornar</td></tr>
                                <tr><td><input class='acao_check' type='checkbox' name='Acoes' value='2' style="margin-top: -2px" /> Sem Movimento</td></tr>
                                <tr><td><input class='acao_check' id="check_outros" type='checkbox' name='Acoes' value='3' style="margin-top: -2px" /> Outros</td></tr>
                            </table>

                            <div id="dadosEnvio" class="hide">
                                <h4>
                                    Dados Envio
                                </h4>
                                <table class="table">
                                    <tr><td>Data</td><td><input name="DadosEnvio.Data" style="height: 35px; margin-bottom: 0px" type="date" value="@DateTime.Now.ToString("yyyy-MM-dd")" /></td></tr>
                                    <tr>
                                        <td>Facção</td>
                                        <td>
                                            <select name="DadosEnvio.FaccaoId" style="margin-bottom: 0px" class="form-control inputRequired" id="FaccaoId">
                                                <option value="0"></option>
                                                @{
        foreach (var faccao in faccoes)
        {
            <option value="@faccao.Id">
                @faccao.Descricao.ToUpper()
            </option>
        }
                                                }
                                            </select>
                                        </td>
                                    </tr>
                                    <tr><td>Intervalo</td><td><input style="height: 35px; margin-bottom: 0px" type="number" min="0" name="DadosEnvio.Intervalo" value="2" /></td></tr>
                                    <tr>
                                        <td>Status</td>
                                        <td>
                                            <select name="DadosEnvio.Status" style="width: 206px; margin-bottom: 0px" class="form-control" id="Status">
                                                <option value="0">Pendente</option>
                                                <option value="1">Concluído</option>
                                            </select>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="Produtos" class="tab-pane fade">
                    <h4>
                        Produtos
                    </h4>
                    <input class='MarcarTodosProduto' type='checkbox' id='MarcarTodosProduto' name='MarcarTodosProduto' value='0' style="margin-top: 0" /> Marcar Todos | 
                    <input class='QtdeTotalProduto' type='checkbox' id='QtdeTotalProduto' name='QtdeTotalProduto' value='0' style="margin-top: 0" /> Qtde Total Produto
                    <table class="table table-condensed">
                        @{
        foreach (var pedido in pedidos)
        {
            <tr class="pedido_@pedido.Id hidden">
                <th colspan="3">
                    @pedido.Cliente.Nome - @pedido.Numero
                </th>
            </tr>

            foreach (var pedidoProduto in pedido.PedidoProduto)
            {
                <tr class="pedido_@pedido.Id hidden trPedidoProduto">
                    <td width="1%">
                        <input class="pedidoProduto_check" type='checkbox' name='PedidoProdutos[@pedidoProduto.Id].Produto' value='@pedidoProduto.Id' style="margin-top: 0" />
                    </td>
                    <td width="5%">
                        <input id="PedidoProdutoQuantidade_@pedidoProduto.Id" class="pedidoProduto_Quantidade tdPedidoProduto" type='number' min="0" max="@pedidoProduto.Quantidade" name='PedidoProdutos[@pedidoProduto.Id].Quantidade' value='0' data-quantidade="@pedidoProduto.Quantidade" style="margin-top: 0; width: 70px; height: 30px" />
                        <input id="PedidoProdutoPedido_@pedidoProduto.Id" class="pedidoProduto_Hidden" type='hidden' name='PedidoProdutos[@pedidoProduto.Id].Pedido' value='@pedidoProduto.Pedido.Id' style="margin-top: 0; width: 70px; height: 30px" />
                    </td>
                    <td>
                        @pedidoProduto.Quantidade @pedidoProduto.Produto.Nome @pedidoProduto.Tecido.Nome
                    </td>
                </tr>
            }
        }
                        }
                    </table>
                </div>
                <div id="Lancamentos" class="tab-pane fade">
                    <button id="BtnLancarFluxo" type="submit" class="btn" style="margin-top: 10px">
                        Lançar
                    </button>

                    <h4>
                        Lançamentos Existentes
                    </h4>

                    <table class="table table-condensed">
                        <tr>
                            <th>Produto</th>
                            <th>Data</th>
                            <th>Quantidade</th>
                            <th>Cliente/Pedido</th>
                            <th>Ação</th>
                            <th>Andamento</th>
                            <th>Facção</th>
                            <th>Status</th>
                        </tr>
                        @foreach (var pedido in pedidos)
                        {
                            var fluxos = allfluxos.Where(x => x.Pedido.Id == pedido.Id);
                            foreach (var fluxo in fluxos)
                            {
                                var classe = string.Format("pedido_{0}_andamento_{1}_acao_{2}_pedidoProduto_{3}", fluxo.Pedido.Id, fluxo.Andamento, (int)fluxo.EnvioRetorno, fluxo.PedidoProduto.Id);
                                <tr class="@classe fluxosLancados hidden">
                                    <td>
                                        <input class="lancamentosAtualizar_check" type='checkbox' name='lancamentosAtualizar[@fluxo.Id]' value='@fluxo.Id' style="margin-top: 0" />
                                        @fluxo.PedidoProduto.Produto.Nome @fluxo.PedidoProduto.Tecido.Nome
                                    </td>
                                    <td>
                                        @fluxo.Data.ToString("dd/MM/yyyy")
                                    </td>
                                    <td>
                                        @fluxo.Quantidade
                                    </td>
                                    <td>
                                        @pedido.Cliente.Nome - @pedido.Numero
                                    </td>
                                    <td>
                                        @fluxo.EnvioRetorno
                                    </td>
                                    <td>
                                        @{
                                switch (fluxo.Andamento)
                                {
                                    case 0:
                                        <p>Arte</p>
                                        break;
                                    case 1:
                                    <p>Modelagem</p>
                                        break;
                                    case 2:
                                    <p>Matéria Prima</p>
                                        break;
                                    case 3:
                                    <p>Corte</p>
                                        break;
                                    case 4:
                                    <p>Silk Parte</p>
                                        break;
                                    case 5:
                                    <p>Bordado Parte</p>
                                        break;
                                    case 6:
                                    <p>Costura</p>
                                        break;
                                    case 7:
                                    <p>Botões</p>
                                        break;
                                    case 8:
                                    <p>Conferência</p>
                                        break;
                                    case 9:
                                    <p>Etapa Extra 1</p>
                                        break;
                                    case 10:
                                    <p>Silk Peça</p>
                                        break;
                                    case 11:
                                    <p>Bordado Peça</p>
                                        break;
                                    case 12:
                                    <p>Botão Posterior</p>
                                        break;
                                    case 13:
                                    <p>Etapa Extra 2</p>
                                        break;
                                    case 14:
                                    <p>Embalagem</p>
                                        break;
                                    case 15:
                                    <p>Entrega</p>
                                        break;
                                }
                                        }
                                    </td>
                                    <td>
                                        @fluxo.Quem.Descricao
                                    </td>
                                    <td>
                                        @fluxo.StatusFluxo
                                    </td>
                                </tr>
                            }
                        }
                    </table>
                </div>
            </div>
        </div>
    }
    <script src="~/Scripts/ajax/fluxos.js"></script>
    <script>
        $(document).ready(function () {
            $(".nav-tabs a").click(function () {
                $(this).tab('show');
            });
        });
    </script>
</body>
</html>
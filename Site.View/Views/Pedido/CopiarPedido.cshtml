@using Site.DTO
@using Site.Enums
@using Site.IServico.Pedidos
@using Site.Servico.Pedidos
@model Site.View.ViewModel.PesquisaPedidoViewModel
@{
    ViewBag.Title = "CopiarPedido";

    IClienteServico clienteServico = new ClienteServico();
    IVendedorServico vendedorServico = new VendedorServico();
    IProdutoServico produtoServico = new ProdutoServico();
    ITecidoServico tecidoServico = new TecidoServico();

    var clientes = clienteServico.GetAll().Where(x => x.Ativo == StatusCliente.Normal).OrderBy(y => y.Nome).ToList();
    var vendedores = vendedorServico.GetAll().Where(x => x.Ativo == Status.Ativo).OrderBy(y => y.Descricao);
    var tecidos = tecidoServico.GetAll();
    var produtos = produtoServico.GetAll().OrderBy(x => x.Nome).ToList();   
}
<div class="container-fluid" >

    <div class="alert alert-info">
        <div style="text-align: center;">
            <h4>
                Pesquisar Pedidos
            </h4>
        </div>
    </div>
    @using (Html.BeginForm("CopiarPedido", "Pedido"))
    {        
        <input id="pedidoAtual" type="hidden" name="pedidoSession" value="@Model.PedidoSession" />
        
        <table class="">
            <tbody>
                <tr>
                    <td>
                        <div class="control-group">
                            <label class="control-label">
                                Cliente
                            </label>
                            <div class="controls">
                                <select name="Cliente.Id">
                                    <option value="0"></option>
                                    @{
                                        foreach (var item in clientes)
                                        {
                                            string select = string.Empty;
                                            
                                            if (item.Id == Model.Cliente.Id)
                                            {
                                                select = "selected";
                                            }
                                            <option value="@item.Id" @select>@item.Nome</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="control-group">
                            <label class="control-label">
                                Produto
                            </label>
                            <div class="controls">
                                <select name="Produto.Id">
                                    <option value="0"></option>
                                    @{
                                        foreach (var item in produtos)
                                        {
                                            string select = string.Empty;

                                            if (item.Id == Model.Produto.Id)
                                            {
                                                select = "selected";
                                            }            
                                            <option value="@item.Id" @select>@item.Nome</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="control-group">
                            <label class="control-label">
                                Tecido
                            </label>
                            <div class="controls">
                                <select name="Tecido.Id">
                                    <option value="0"></option>
                                    @{
                                        foreach (var item in tecidos)
                                        {
                                            string select = string.Empty;

                                            if (item.Id == Model.Tecido.Id)
                                            {
                                                select = "selected";
                                            }             
                                            <option value="@item.Id" @select>@item.Nome</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="control-group">
                            <label class="control-label">
                                Vendedor
                            </label>
                            <div class="controls">
                                <select name="Vendedor.id">
                                    <option value="0"></option>
                                    @{
                                        foreach (var item in vendedores)
                                        {
                                            string select = string.Empty;

                                            if (item.Id == Model.Vendedor.Id)
                                            {
                                                select = "selected";
                                            }               
                                            <option value="@item.Id" @select>@item.Descricao</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="control-group">
                            <label class="control-label">
                                Status
                            </label>
                            <div class="controls">
                                <select name="Status" class="input-medium">
                                    <option value="0"></option>
                                    <option value="1">Aberto</option>
                                    <option value="2">Concluído</option>
                                </select>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="control-group">
                            <label class="control-label">
                                Limite
                            </label>
                            <div class="controls">
                                <select name="Limite" class="input-medium">
                                    <option value="0"></option>
                                    <option value="1">01 Pedido</option>
                                    <option value="2">02 Pedidos</option>
                                    <option value="3">03 Pedidos</option>
                                    <option value="4">04 Pedidos</option>
                                    <option value="5">05 Pedidos</option>
                                    <option value="6">06 Pedidos</option>
                                    <option value="7">07 Pedidos</option>
                                    <option value="8">08 Pedidos</option>
                                    <option value="9">09 Pedidos</option>
                                    <option value="10" selected="selected">10 Pedidos</option>
                                    <option value="20">20 Pedidos</option>
                                    <option value="25">25 Pedidos</option>
                                    <option value="50">50 Pedidos</option>
                                </select>
                            </div>
                        </div>
                    </td>
                    <td>
                        <button type="submit" class="btn" style="margin-top: 4px">
                            Pesquisar
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    }
    
    @using (Html.BeginForm("CreatePesquisa", "Pedido"))
    {
        <input id="pedidoAtualPesquisa" type="hidden" name="pedidoAtualPesquisa" value="@Model.PedidoSession" />

                <button type="submit" class="btn" style="margin-top: -50px">
                Pedido
            </button>        
    }

    <table class="table" style="margin-top: -10px">
        <tbody>
            <tr>
                <th>
                    Cliente
                </th>
                <th>
                    Pedido
                </th>
                <th>
                    Data
                </th>
                <th>
                    Qtde Produtos
                </th>
                <th>
                    Produtos
                </th>
                <th>
                    Status
                </th>
                <th>
                    Ação
                </th>
            </tr>
            @{
                foreach (var item in Model.Pedidos)
                {
                    <tr>
                        <td>
                            @item.Cliente.Nome
                        </td>
                        <td>
                            @item.Numero
                        </td>
                        <td>
                            @item.DataCriacao.ToString("dd/MM/yyyy")
                        </td>
                        <td>
                            @item.PedidoProduto.Count
                        </td>
                        <td>
                            <a class="verProdutoPesquisa" data-produto="@item.Id">Ver</a>
                        </td>
                        <td>
                            @item.StatusPedido
                        </td>
                        <td>
                            @Html.ActionLink("Copiar", "Copy", new { id = item.Id })
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>        
</div>

<div style="width: 700px; margin-left: -400px"  class="modal" id="Modal_ProdutosPesquisa" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
                <h4 class="modal-title" id="myModalLabel">Produtos do Pedido</h4>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <input class="btn btn-default" type="button" data-dismiss="modal" value="Fechar" onclick="" />
            </div>
        </div>
    </div>
</div>

<div class="modal" id="Modal_ItensPesquisa" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" hidden>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
                <h4 class="modal-title" id="myModalLabel">Itens do Produto</h4>
            </div>
            <div class="modal-body">

            </div>
            <div class="modal-footer">
                <input class="btn btn-default" type="button" data-dismiss="modal" value="Fechar" onclick="" />
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js">
</script>
<script src="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js">
</script>

<script src="~/Scripts/ajax/pedidos.js"></script>
